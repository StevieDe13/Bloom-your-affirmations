<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bloom ‚Äî Affirmation Pairs Game</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,500;1,400;1,500&family=Nunito:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #0f0c1a;
    --surface: #1a1628;
    --surface2: #221e33;
    --border: rgba(255,255,255,0.08);
    --border2: rgba(255,255,255,0.14);
    --violet: #a78bfa;
    --violet-soft: rgba(167,139,250,0.15);
    --pink: #f472b6;
    --gold: #fbbf24;
    --green: #34d399;
    --text: #f0ebff;
    --muted: #9590aa;
    --dim: #5c5870;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    font-family: 'Nunito', sans-serif;
    background: var(--bg);
    color: var(--text);
    min-height: 100vh;
    overflow-x: hidden;
  }

  .stars { position: fixed; inset: 0; z-index: 0; pointer-events: none; }
  .star { position: absolute; border-radius: 50%; background: white; animation: twinkle var(--d,3s) infinite var(--delay,0s); opacity: 0; }
  @keyframes twinkle { 0%,100%{opacity:0} 50%{opacity:var(--op,0.6)} }

  .orb { position: fixed; border-radius: 50%; filter: blur(100px); pointer-events: none; z-index: 0; }
  .orb-1 { width: 500px; height: 500px; background: rgba(139,92,246,0.15); top: -150px; right: -100px; }
  .orb-2 { width: 400px; height: 400px; background: rgba(236,72,153,0.10); bottom: -100px; left: -80px; }

  .container {
    position: relative;
    z-index: 1;
    max-width: 860px;
    margin: 0 auto;
    padding: 40px 20px 80px;
  }

  /* ‚îÄ‚îÄ Header ‚îÄ‚îÄ */
  header {
    text-align: center;
    margin-bottom: 32px;
    animation: fadeDown 0.7s ease both;
  }
  .back-btn {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 7px 16px;
    border-radius: 100px;
    border: 1px solid var(--border2);
    background: transparent;
    color: var(--muted);
    font-family: 'Nunito', sans-serif;
    font-size: 0.8rem;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s;
    margin-bottom: 20px;
    text-decoration: none;
  }
  .back-btn:hover { color: var(--violet); border-color: rgba(167,139,250,0.4); }

  .game-badge {
    display: inline-block;
    background: linear-gradient(135deg, rgba(251,191,36,0.2), rgba(244,114,182,0.2));
    border: 1px solid rgba(251,191,36,0.4);
    border-radius: 100px;
    padding: 5px 16px;
    font-size: 0.72rem;
    font-weight: 700;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    color: var(--gold);
    margin-bottom: 12px;
  }

  header h1 {
    font-family: 'Playfair Display', serif;
    font-size: clamp(1.8rem, 4vw, 2.6rem);
    font-weight: 400;
    background: linear-gradient(135deg, #e2d9f3 0%, #a78bfa 50%, #f472b6 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    margin-bottom: 6px;
  }

  header p {
    font-size: 0.9rem;
    color: var(--muted);
    max-width: 480px;
    margin: 0 auto;
    line-height: 1.6;
  }

  /* ‚îÄ‚îÄ Affirmation selector ‚îÄ‚îÄ */
  .selector-card {
    background: var(--surface);
    border: 1px solid var(--border2);
    border-radius: 20px;
    padding: 24px 28px;
    margin-bottom: 24px;
    animation: fadeUp 0.7s 0.1s ease both;
    box-shadow: 0 4px 32px rgba(0,0,0,0.35);
  }
  .selector-card label {
    display: block;
    font-size: 0.75rem;
    font-weight: 700;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    color: var(--violet);
    margin-bottom: 10px;
  }
  .selector-row {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
    align-items: center;
  }
  .aff-select {
    flex: 1;
    min-width: 200px;
    background: var(--surface2);
    border: 1px solid var(--border2);
    border-radius: 12px;
    color: var(--text);
    font-family: 'Nunito', sans-serif;
    font-size: 0.9rem;
    padding: 10px 14px;
    outline: none;
    cursor: pointer;
    transition: border-color 0.2s;
  }
  .aff-select:focus { border-color: rgba(167,139,250,0.5); }

  .custom-input {
    flex: 1;
    min-width: 200px;
    background: var(--surface2);
    border: 1px solid var(--border2);
    border-radius: 12px;
    color: var(--text);
    font-family: 'Nunito', sans-serif;
    font-size: 0.9rem;
    padding: 10px 14px;
    outline: none;
    transition: border-color 0.2s;
    display: none;
  }
  .custom-input::placeholder { color: var(--dim); }
  .custom-input:focus { border-color: rgba(167,139,250,0.5); }
  .custom-input.visible { display: block; }

  .start-btn {
    padding: 11px 28px;
    border-radius: 12px;
    border: none;
    background: linear-gradient(135deg, #7c3aed, #a855f7);
    color: white;
    font-family: 'Nunito', sans-serif;
    font-size: 0.9rem;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.25s;
    box-shadow: 0 4px 20px rgba(124,58,237,0.35);
    white-space: nowrap;
  }
  .start-btn:hover { transform: translateY(-2px); box-shadow: 0 6px 28px rgba(124,58,237,0.5); }

  /* ‚îÄ‚îÄ Stats bar ‚îÄ‚îÄ */
  .stats-bar {
    display: flex;
    justify-content: center;
    gap: 24px;
    margin-bottom: 20px;
    animation: fadeUp 0.7s 0.15s ease both;
    flex-wrap: wrap;
  }
  .stat {
    text-align: center;
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 14px;
    padding: 10px 20px;
    min-width: 90px;
  }
  .stat-val {
    font-family: 'Playfair Display', serif;
    font-size: 1.5rem;
    font-weight: 400;
    color: var(--violet);
    line-height: 1;
  }
  .stat-label {
    font-size: 0.7rem;
    font-weight: 600;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    color: var(--dim);
    margin-top: 3px;
  }

  /* ‚îÄ‚îÄ Affirmation display ‚îÄ‚îÄ */
  .aff-display {
    background: var(--surface);
    border: 1px solid var(--border2);
    border-radius: 20px;
    padding: 20px 28px;
    text-align: center;
    margin-bottom: 20px;
    animation: fadeUp 0.7s 0.2s ease both;
    min-height: 70px;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  .aff-display p {
    font-family: 'Playfair Display', serif;
    font-size: clamp(0.95rem, 2.5vw, 1.15rem);
    font-weight: 400;
    font-style: italic;
    color: var(--muted);
    line-height: 1.5;
  }
  .aff-display p span.revealed {
    color: var(--violet);
    font-style: normal;
    font-weight: 500;
    transition: color 0.3s;
  }

  /* ‚îÄ‚îÄ Game board ‚îÄ‚îÄ */
  .board-wrap {
    animation: fadeUp 0.7s 0.25s ease both;
  }
  .board-label {
    font-size: 0.72rem;
    font-weight: 700;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    color: var(--dim);
    margin-bottom: 10px;
    text-align: center;
  }
  .board {
    display: grid;
    gap: 10px;
    margin-bottom: 32px;
    justify-content: center;
  }

  /* ‚îÄ‚îÄ Cards ‚îÄ‚îÄ */
  .card-wrap {
    perspective: 600px;
  }
  .card {
    width: 100%;
    aspect-ratio: 1;
    position: relative;
    transform-style: preserve-3d;
    transition: transform 0.45s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    cursor: pointer;
    border-radius: 14px;
  }
  .card.flipped { transform: rotateY(180deg); }
  .card.matched { transform: rotateY(180deg); cursor: default; }

  .card-face {
    position: absolute;
    inset: 0;
    border-radius: 14px;
    display: flex;
    align-items: center;
    justify-content: center;
    backface-visibility: hidden;
    -webkit-backface-visibility: hidden;
    padding: 6px;
  }

  /* Front (hidden side) */
  .card-front {
    background: var(--surface);
    border: 1px solid var(--border2);
    box-shadow: 0 2px 12px rgba(0,0,0,0.3);
    transition: border-color 0.2s, box-shadow 0.2s;
  }
  .card-wrap:hover .card:not(.flipped):not(.matched) .card-front {
    border-color: rgba(167,139,250,0.4);
    box-shadow: 0 0 20px rgba(167,139,250,0.15);
  }
  .card-front-inner {
    width: 36px;
    height: 36px;
    background: var(--violet-soft);
    border: 1px solid rgba(167,139,250,0.25);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1rem;
    color: rgba(167,139,250,0.5);
  }

  /* Back (word side) */
  .card-back {
    background: linear-gradient(135deg, #2d1f5e, #1e1535);
    border: 1.5px solid rgba(167,139,250,0.35);
    box-shadow: 0 0 20px rgba(167,139,250,0.12);
    transform: rotateY(180deg);
    text-align: center;
  }
  .card-back span {
    font-family: 'Playfair Display', serif;
    font-size: clamp(0.65rem, 1.8vw, 0.9rem);
    font-weight: 400;
    color: var(--text);
    line-height: 1.3;
    word-break: break-word;
    hyphens: auto;
  }
  .card.matched .card-back {
    background: linear-gradient(135deg, #1a3a2a, #122b1e);
    border-color: rgba(52,211,153,0.5);
    box-shadow: 0 0 24px rgba(52,211,153,0.2);
  }
  .card.matched .card-back span { color: var(--green); }

  /* wrong flash */
  .card.wrong .card-back {
    animation: wrongFlash 0.5s ease;
  }
  @keyframes wrongFlash {
    0%,100% { border-color: rgba(167,139,250,0.35); box-shadow: 0 0 20px rgba(167,139,250,0.12); }
    50% { border-color: rgba(244,114,182,0.7); box-shadow: 0 0 28px rgba(244,114,182,0.3); }
  }

  /* ‚îÄ‚îÄ Win screen ‚îÄ‚îÄ */
  .win-screen {
    display: none;
    text-align: center;
    background: var(--surface);
    border: 1px solid var(--border2);
    border-radius: 24px;
    padding: 48px 36px;
    margin-top: 24px;
    box-shadow: 0 4px 40px rgba(0,0,0,0.4);
    animation: popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275) both;
  }
  .win-screen.show { display: block; }
  @keyframes popIn { from { opacity:0; transform:scale(0.85); } to { opacity:1; transform:scale(1); } }

  .win-emoji { font-size: 3rem; margin-bottom: 16px; }
  .win-screen h2 {
    font-family: 'Playfair Display', serif;
    font-size: 1.8rem;
    font-weight: 400;
    background: linear-gradient(135deg, #e2d9f3, #a78bfa, #f472b6);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    margin-bottom: 12px;
  }
  .win-affirmation {
    font-family: 'Playfair Display', serif;
    font-size: clamp(1rem, 2.5vw, 1.3rem);
    font-weight: 400;
    font-style: italic;
    color: var(--text);
    line-height: 1.6;
    margin: 20px 0;
    padding: 20px 24px;
    background: linear-gradient(135deg, rgba(167,139,250,0.08), rgba(244,114,182,0.08));
    border-radius: 16px;
    border: 1px solid rgba(167,139,250,0.2);
  }
  .win-stats {
    font-size: 0.9rem;
    color: var(--muted);
    margin-bottom: 24px;
  }
  .win-stats strong { color: var(--violet); }
  .win-btns { display: flex; gap: 12px; justify-content: center; flex-wrap: wrap; }
  .win-btn {
    padding: 12px 28px;
    border-radius: 12px;
    border: none;
    background: linear-gradient(135deg, #7c3aed, #a855f7);
    color: white;
    font-family: 'Nunito', sans-serif;
    font-size: 0.9rem;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.25s;
    box-shadow: 0 4px 20px rgba(124,58,237,0.35);
  }
  .win-btn:hover { transform: translateY(-2px); box-shadow: 0 6px 28px rgba(124,58,237,0.5); }
  .win-btn.secondary {
    background: var(--surface2);
    border: 1px solid var(--border2);
    color: var(--muted);
    box-shadow: none;
  }
  .win-btn.secondary:hover { color: var(--text); border-color: rgba(255,255,255,0.2); box-shadow: none; transform: none; }

  @keyframes fadeDown { from{opacity:0;transform:translateY(-20px)} to{opacity:1;transform:none} }
  @keyframes fadeUp { from{opacity:0;transform:translateY(20px)} to{opacity:1;transform:none} }

  @media (max-width: 480px) {
    .selector-card { padding: 18px 16px; }
    .stats-bar { gap: 10px; }
    .stat { padding: 8px 14px; min-width: 70px; }
  }
</style>
</head>
<body>

<div class="stars" id="stars"></div>
<div class="orb orb-1"></div>
<div class="orb orb-2"></div>

<div class="container">
  <header>
    <div><a class="back-btn" href="index.html" onclick="sessionStorage.setItem('forceReload','1')">‚Üê Back to Bloom</a></div>
    <div class="game-badge">‚ú¶ Memory Game</div>
    <h1>Affirmation Pairs</h1>
    <p>Match each word to its pair. The full affirmation reveals itself as you play ‚Äî absorbing it without even trying.</p>
  </header>

  <div class="selector-card">
    <label>Choose one of your saved affirmations to play with</label>
    <div class="selector-row">
      <select class="aff-select" id="affSelect" onchange="onSelectChange()">
        <option value="">‚Äî Loading your affirmations... ‚Äî</option>
      </select>
      <input class="custom-input" id="customInput" type="text" placeholder="Type your affirmation here..." maxlength="180" />
      <button class="start-btn" onclick="startGame()">‚ñ∂ Play</button>
    </div>
    <p id="noSavedMsg" style="display:none; margin-top:12px; font-size:0.85rem; color:var(--muted);">
      You haven't saved any affirmations yet! <a href="affirmations-app.html" style="color:var(--violet);">Go back and save some first</a>, or type one below. ‚ú¶
    </p>
  </div>

  <div id="gameArea" style="display:none">
    <div class="stats-bar">
      <div class="stat"><div class="stat-val" id="movesVal">0</div><div class="stat-label">Moves</div></div>
      <div class="stat"><div class="stat-val" id="pairsVal">0</div><div class="stat-label">Pairs</div></div>
      <div class="stat"><div class="stat-val" id="timeVal">0:00</div><div class="stat-label">Time</div></div>
    </div>

    <div class="aff-display">
      <p id="affProgress"></p>
    </div>

    <div class="board-wrap">
      <div class="board-label">Tap a tile to reveal the word beneath</div>
      <div class="board" id="board"></div>
    </div>

    <div class="win-screen" id="winScreen">
      <div class="win-emoji">üå∏</div>
      <h2>You remembered it!</h2>
      <div class="win-affirmation" id="winAff"></div>
      <div class="win-stats" id="winStats"></div>
      <div class="win-btns">
        <button class="win-btn" onclick="startGame()">‚ñ∂ Play Again</button>
        <button class="win-btn secondary" onclick="location.href='affirmations-app.html'">‚Üê Back to Bloom</button>
      </div>
    </div>
  </div>
</div>

<script>
// Load saved affirmations when page opens
loadSavedAffirmations();

(function() {
  const c = document.getElementById('stars');
  for (let i = 0; i < 60; i++) {
    const s = document.createElement('div');
    s.className = 'star';
    const sz = Math.random() * 2 + 0.5;
    s.style.cssText = `width:${sz}px;height:${sz}px;top:${Math.random()*100}%;left:${Math.random()*100}%;--d:${2+Math.random()*4}s;--delay:${Math.random()*5}s;--op:${0.3+Math.random()*0.7}`;
    c.appendChild(s);
  }
})();

// ‚îÄ‚îÄ Load saved affirmations from localStorage ‚îÄ‚îÄ
function loadSavedAffirmations() {
  const saved = JSON.parse(localStorage.getItem('bloom_saved_v2') || '[]');
  const select = document.getElementById('affSelect');
  const noMsg = document.getElementById('noSavedMsg');
  select.innerHTML = '';

  if (saved.length === 0) {
    select.innerHTML = '<option value="custom">‚úèÔ∏è Type my own affirmation...</option>';
    noMsg.style.display = 'block';
    document.getElementById('customInput').classList.add('visible');
  } else {
    select.innerHTML = '<option value="">‚Äî Choose one of your affirmations ‚Äî</option>';
    saved.forEach((item, i) => {
      const opt = document.createElement('option');
      opt.value = item.affirmation;
      // Truncate long affirmations for display
      const label = item.affirmation.length > 55
        ? item.affirmation.slice(0, 52) + '...'
        : item.affirmation;
      opt.textContent = `${item.theme ? '[' + item.theme + '] ' : ''}${label}`;
      select.appendChild(opt);
    });
    // Always offer custom option at the end
    const custom = document.createElement('option');
    custom.value = 'custom';
    custom.textContent = '‚úèÔ∏è Type my own affirmation...';
    select.appendChild(custom);
    noMsg.style.display = 'none';
  }
}

function onSelectChange() {
  const sel = document.getElementById('affSelect').value;
  const inp = document.getElementById('customInput');
  if (sel === 'custom') inp.classList.add('visible');
  else inp.classList.remove('visible');
}

// ‚îÄ‚îÄ Game state ‚îÄ‚îÄ
let words = [];
let affirmation = '';
let flipped = [];
let matched = [];
let moves = 0;
let pairs = 0;
let timerInterval = null;
let seconds = 0;
let locked = false;

function cleanAffirmation(text) {
  // Remove punctuation, split into words, remove duplicates & very short words
  return text.replace(/[^a-zA-Z\s'-]/g, '').split(/\s+/).filter(w => w.length >= 1);
}

function startGame() {
  let text = document.getElementById('affSelect').value;
  if (text === 'custom') text = document.getElementById('customInput').value.trim();
  if (!text || text === '') { alert('Please choose or type an affirmation first!'); return; }

  affirmation = text;
  const allWords = cleanAffirmation(text);

  // Pick up to 8 unique meaningful words (prefer longer words)
  const sorted = [...new Set(allWords)].sort((a,b) => b.length - a.length);
  const selected = sorted.slice(0, Math.min(8, sorted.length));

  // Need at least 4 pairs
  if (selected.length < 4) {
    alert('Affirmation is too short ‚Äî please use a longer one!');
    return;
  }

  words = selected;
  flipped = [];
  matched = [];
  moves = 0;
  pairs = 0;
  seconds = 0;
  locked = false;

  clearInterval(timerInterval);
  timerInterval = setInterval(() => {
    seconds++;
    const m = Math.floor(seconds/60);
    const s = seconds % 60;
    document.getElementById('timeVal').textContent = `${m}:${s.toString().padStart(2,'0')}`;
  }, 1000);

  updateStats();
  buildBoard();
  updateProgress();
  document.getElementById('winScreen').classList.remove('show');
  document.getElementById('gameArea').style.display = 'block';
  document.getElementById('gameArea').scrollIntoView({ behavior: 'smooth', block: 'start' });
}

function buildBoard() {
  const board = document.getElementById('board');
  board.innerHTML = '';

  // Create pairs: each word appears twice
  const cardWords = [...words, ...words];
  // Shuffle
  for (let i = cardWords.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [cardWords[i], cardWords[j]] = [cardWords[j], cardWords[i]];
  }

  const total = cardWords.length;
  const cols = total <= 8 ? 4 : total <= 12 ? 4 : 4;
  board.style.gridTemplateColumns = `repeat(${cols}, 1fr)`;
  board.style.maxWidth = cols <= 4 ? '460px' : '580px';
  board.style.margin = '0 auto 32px';

  cardWords.forEach((word, i) => {
    const wrap = document.createElement('div');
    wrap.className = 'card-wrap';

    const card = document.createElement('div');
    card.className = 'card';
    card.dataset.word = word;
    card.dataset.index = i;

    card.innerHTML = `
      <div class="card-face card-front">
        <div class="card-front-inner">‚ú¶</div>
      </div>
      <div class="card-face card-back">
        <span>${word}</span>
      </div>
    `;

    card.addEventListener('click', () => onCardClick(card));
    wrap.appendChild(card);
    board.appendChild(wrap);
  });
}

function onCardClick(card) {
  if (locked) return;
  if (card.classList.contains('flipped') || card.classList.contains('matched')) return;

  card.classList.add('flipped');
  flipped.push(card);

  if (flipped.length === 2) {
    locked = true;
    moves++;
    updateStats();
    checkMatch();
  }
}

function checkMatch() {
  const [a, b] = flipped;
  if (a.dataset.word === b.dataset.word) {
    // Match!
    setTimeout(() => {
      a.classList.remove('flipped');
      b.classList.remove('flipped');
      a.classList.add('matched');
      b.classList.add('matched');
      matched.push(a.dataset.word);
      pairs++;
      updateStats();
      updateProgress();
      flipped = [];
      locked = false;

      if (pairs === words.length) {
        clearInterval(timerInterval);
        setTimeout(showWin, 600);
      }
    }, 400);
  } else {
    // No match ‚Äî flash pink then flip back
    a.classList.add('wrong');
    b.classList.add('wrong');
    setTimeout(() => {
      a.classList.remove('wrong');
      b.classList.remove('wrong');
      a.classList.remove('flipped');
      b.classList.remove('flipped');
      flipped = [];
      locked = false;
    }, 900);
  }
}

function updateStats() {
  document.getElementById('movesVal').textContent = moves;
  document.getElementById('pairsVal').textContent = pairs + '/' + words.length;
}

function updateProgress() {
  // Show the full affirmation with matched words highlighted
  const allWords = cleanAffirmation(affirmation);
  const matchedSet = new Set(matched.map(w => w.toLowerCase()));

  const html = allWords.map(w => {
    const clean = w.replace(/[^a-zA-Z'-]/g,'').toLowerCase();
    if (matchedSet.has(clean)) {
      return `<span class="revealed">${w}</span>`;
    }
    return `<span style="color:var(--dim)">${w}</span>`;
  }).join(' ');

  document.getElementById('affProgress').innerHTML = html;
}

function showWin() {
  const m = Math.floor(seconds/60);
  const s = seconds % 60;
  document.getElementById('winAff').textContent = '"' + affirmation + '"';
  document.getElementById('winStats').innerHTML =
    `Completed in <strong>${moves} moves</strong> and <strong>${m}:${s.toString().padStart(2,'0')}</strong> ‚Äî beautifully done.`;
  document.getElementById('winScreen').classList.add('show');
  document.getElementById('winScreen').scrollIntoView({ behavior: 'smooth', block: 'center' });
}
</script>
</body>
</html>
