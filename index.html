<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bloom ‚Äî Your Affirmations</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,500;1,400;1,500&family=Nunito:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #0f0c1a;
    --surface: #1a1628;
    --surface2: #221e33;
    --border: rgba(255,255,255,0.08);
    --border2: rgba(255,255,255,0.14);
    --violet: #a78bfa;
    --violet-soft: rgba(167,139,250,0.15);
    --pink: #f472b6;
    --gold: #fbbf24;
    --text: #f0ebff;
    --muted: #9590aa;
    --dim: #5c5870;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    font-family: 'Nunito', sans-serif;
    background: var(--bg);
    color: var(--text);
    min-height: 100vh;
    overflow-x: hidden;
  }

  .stars { position: fixed; inset: 0; z-index: 0; pointer-events: none; }
  .star {
    position: absolute;
    border-radius: 50%;
    background: white;
    animation: twinkle var(--d, 3s) infinite var(--delay, 0s);
    opacity: 0;
  }
  @keyframes twinkle { 0%,100% { opacity: 0; } 50% { opacity: var(--op, 0.6); } }

  .orb { position: fixed; border-radius: 50%; filter: blur(100px); pointer-events: none; z-index: 0; }
  .orb-1 { width: 500px; height: 500px; background: rgba(139,92,246,0.18); top: -150px; right: -100px; }
  .orb-2 { width: 400px; height: 400px; background: rgba(236,72,153,0.12); bottom: -100px; left: -80px; }
  .orb-3 { width: 250px; height: 250px; background: rgba(251,191,36,0.08); top: 50%; left: 50%; transform: translate(-50%,-50%); }

  .container { position: relative; z-index: 1; max-width: 720px; margin: 0 auto; padding: 64px 24px 100px; }

  header { text-align: center; margin-bottom: 56px; animation: fadeDown 0.9s ease both; }

  .app-badge {
    display: inline-block;
    background: linear-gradient(135deg, rgba(167,139,250,0.2), rgba(244,114,182,0.2));
    border: 1px solid rgba(167,139,250,0.4);
    border-radius: 100px;
    padding: 6px 18px;
    font-size: 0.75rem;
    font-weight: 700;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    color: var(--violet);
    margin-bottom: 16px;
  }

  header h1 {
    font-family: 'Playfair Display', serif;
    font-size: clamp(2.4rem, 5.5vw, 3.4rem);
    font-weight: 400;
    letter-spacing: -0.01em;
    line-height: 1.15;
    background: linear-gradient(135deg, #e2d9f3 0%, #a78bfa 50%, #f472b6 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .tagline {
    margin-top: 12px;
    font-size: 1rem;
    font-weight: 400;
    color: var(--muted);
    letter-spacing: 0.01em;
    line-height: 1.6;
  }

  .how-btn {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    margin-top: 16px;
    padding: 8px 18px;
    border-radius: 100px;
    border: 1px solid var(--border2);
    background: transparent;
    color: var(--muted);
    font-family: 'Nunito', sans-serif;
    font-size: 0.8rem;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s ease;
    letter-spacing: 0.03em;
  }
  .how-btn:hover { color: var(--violet); border-color: rgba(167,139,250,0.4); }

  .vision-card {
    background: var(--surface);
    border: 1px solid var(--border2);
    border-radius: 24px;
    padding: 36px;
    margin-bottom: 24px;
    animation: fadeUp 0.9s 0.1s ease both;
    box-shadow: 0 4px 40px rgba(0,0,0,0.4);
  }
  .vision-card label {
    display: block;
    font-size: 0.78rem;
    font-weight: 600;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    color: var(--violet);
    margin-bottom: 12px;
  }
  .vision-textarea {
    width: 100%;
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 16px;
    padding: 18px 20px;
    font-family: 'Nunito', sans-serif;
    font-size: 1rem;
    color: var(--text);
    resize: none;
    height: 110px;
    outline: none;
    transition: border-color 0.25s ease, box-shadow 0.25s ease;
    line-height: 1.6;
  }
  .vision-textarea::placeholder { color: var(--dim); }
  .vision-textarea:focus { border-color: rgba(167,139,250,0.4); box-shadow: 0 0 0 3px rgba(167,139,250,0.08); }

  .mood-row { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 16px; margin-bottom: 20px; align-items: center; }
  .quick-label { font-size: 0.75rem; color: var(--dim); margin-right: 4px; }
  .mood-chip {
    padding: 6px 16px;
    border-radius: 100px;
    background: var(--surface2);
    border: 1px solid var(--border);
    font-size: 0.8rem;
    font-weight: 500;
    color: var(--muted);
    cursor: pointer;
    transition: all 0.2s ease;
    font-family: 'Nunito', sans-serif;
  }
  .mood-chip:hover { border-color: rgba(167,139,250,0.4); color: var(--violet); }
  .mood-chip.active { background: var(--violet-soft); border-color: rgba(167,139,250,0.5); color: var(--violet); }

  .btn-row { display: flex; gap: 12px; flex-wrap: wrap; }
  .btn-ai {
    flex: 1;
    min-width: 180px;
    padding: 14px 24px;
    border-radius: 14px;
    border: none;
    background: linear-gradient(135deg, #7c3aed, #a855f7);
    color: white;
    font-family: 'Nunito', sans-serif;
    font-size: 0.92rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.25s ease;
    box-shadow: 0 4px 24px rgba(124,58,237,0.35);
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
  }
  .btn-ai:hover { transform: translateY(-2px); box-shadow: 0 6px 30px rgba(124,58,237,0.5); }

  .btn-random {
    padding: 14px 22px;
    border-radius: 14px;
    border: 1px solid var(--border2);
    background: var(--surface2);
    color: var(--muted);
    font-family: 'Nunito', sans-serif;
    font-size: 0.88rem;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.25s ease;
    white-space: nowrap;
  }
  .btn-random:hover { border-color: rgba(244,114,182,0.4); color: var(--pink); }

  .result-area { animation: fadeUp 0.9s 0.2s ease both; }

  .affirmation-card {
    background: var(--surface);
    border: 1px solid var(--border2);
    border-radius: 24px;
    padding: 48px 40px;
    text-align: center;
    margin-bottom: 16px;
    box-shadow: 0 4px 40px rgba(0,0,0,0.4);
    position: relative;
    overflow: hidden;
  }
  .affirmation-card::after {
    content: '';
    position: absolute;
    inset: 0;
    border-radius: 24px;
    background: linear-gradient(135deg, rgba(167,139,250,0.04), rgba(244,114,182,0.04));
    pointer-events: none;
  }
  .card-glow {
    position: absolute;
    top: 0; left: 50%; transform: translateX(-50%);
    width: 200px; height: 1px;
    background: linear-gradient(90deg, transparent, var(--violet), transparent);
  }

  .affirmation-text {
    font-family: 'Playfair Display', serif;
    font-size: clamp(1.3rem, 3vw, 1.75rem);
    font-weight: 400;
    line-height: 1.6;
    color: var(--text);
    transition: opacity 0.35s ease, transform 0.35s ease;
    position: relative;
    z-index: 1;
  }
  .affirmation-text.fade { opacity: 0; transform: translateY(10px); }
  .affirmation-text.placeholder-text { color: var(--dim); font-style: italic; font-size: 1.1rem; }

  .affirmation-theme {
    margin-top: 20px;
    font-size: 0.75rem;
    font-weight: 600;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    color: var(--violet);
    opacity: 0.7;
  }

  .card-actions { display: flex; justify-content: center; gap: 12px; margin-bottom: 40px; flex-wrap: wrap; }
  .act-btn {
    padding: 10px 20px;
    border-radius: 100px;
    border: 1px solid var(--border2);
    background: var(--surface);
    color: var(--muted);
    font-family: 'Nunito', sans-serif;
    font-size: 0.82rem;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    gap: 6px;
  }
  .act-btn:hover { color: var(--text); border-color: rgba(255,255,255,0.2); }
  .act-btn.save-btn:hover { color: var(--pink); border-color: rgba(244,114,182,0.4); }
  .act-btn.copy-btn {
    background: rgba(251,191,36,0.12);
    border: 1.5px solid rgba(251,191,36,0.45);
    color: var(--gold);
    font-weight: 600;
    padding: 11px 26px;
    font-size: 0.88rem;
    box-shadow: 0 0 16px rgba(251,191,36,0.1);
  }
  .act-btn.copy-btn:hover { background: rgba(251,191,36,0.22); border-color: rgba(251,191,36,0.7); box-shadow: 0 0 24px rgba(251,191,36,0.2); transform: translateY(-1px); }
  .act-btn.share-btn {
    background: rgba(52,211,153,0.1);
    border: 1.5px solid rgba(52,211,153,0.4);
    color: #34d399;
    font-weight: 600;
    padding: 11px 26px;
    font-size: 0.88rem;
  }
  .act-btn.share-btn:hover { background: rgba(52,211,153,0.2); border-color: rgba(52,211,153,0.7); transform: translateY(-1px); }
  .act-btn.speak-btn {
    background: rgba(167,139,250,0.12);
    border: 1.5px solid rgba(167,139,250,0.4);
    color: var(--violet);
    font-weight: 600;
    padding: 11px 26px;
    font-size: 0.88rem;
    box-shadow: 0 0 16px rgba(167,139,250,0.08);
  }
  .act-btn.speak-btn:hover { background: rgba(167,139,250,0.22); border-color: rgba(167,139,250,0.7); transform: translateY(-1px); }
  .act-btn.speak-btn.speaking { background: rgba(167,139,250,0.25); border-color: var(--violet); animation: pulse-speak 1.5s infinite; }
  @keyframes pulse-speak { 0%,100% { box-shadow: 0 0 16px rgba(167,139,250,0.2); } 50% { box-shadow: 0 0 32px rgba(167,139,250,0.5); } }

  .divider { height: 1px; background: var(--border); margin: 40px 0; }

  .game-link {
    background: linear-gradient(135deg, rgba(251,191,36,0.15), rgba(244,114,182,0.15));
    border-color: rgba(251,191,36,0.4);
    color: var(--gold);
    text-decoration: none;
    margin-left: 8px;
  }
  .game-link:hover { color: var(--gold); border-color: rgba(251,191,36,0.7); background: rgba(251,191,36,0.22); }
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.7);
    backdrop-filter: blur(8px);
    z-index: 200;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 24px;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s ease;
  }
  .modal-overlay.open { opacity: 1; pointer-events: all; }
  .modal {
    background: var(--surface);
    border: 1px solid var(--border2);
    border-radius: 28px;
    padding: 40px 36px;
    max-width: 540px;
    width: 100%;
    max-height: 85vh;
    overflow-y: auto;
    transform: translateY(20px);
    transition: transform 0.3s ease;
    box-shadow: 0 24px 80px rgba(0,0,0,0.5);
    position: relative;
  }
  .modal-overlay.open .modal { transform: translateY(0); }
  .modal-close { position: absolute; top: 16px; right: 20px; background: none; border: none; color: var(--dim); font-size: 1.4rem; cursor: pointer; transition: color 0.2s; line-height: 1; }
  .modal-close:hover { color: var(--text); }
  .modal h2 { font-family: 'Playfair Display', serif; font-size: 1.6rem; font-weight: 400; color: var(--text); margin-bottom: 6px; }
  .modal .modal-subtitle { font-size: 0.85rem; color: var(--muted); margin-bottom: 28px; }
  .modal-section { margin-bottom: 24px; }
  .modal-section h3 { font-family: 'Playfair Display', serif; font-size: 1.05rem; font-weight: 400; font-style: italic; color: var(--violet); margin-bottom: 8px; display: flex; align-items: center; gap: 8px; }
  .modal-section p { font-size: 0.9rem; color: #b8b0cc; line-height: 1.7; font-weight: 300; }
  .modal-tip { background: var(--surface2); border: 1px solid var(--border); border-radius: 16px; padding: 16px 20px; margin-top: 24px; font-size: 0.85rem; color: var(--muted); line-height: 1.6; font-style: italic; }
  .modal-tip strong { color: var(--violet); font-style: normal; }

  .toast {
    position: fixed;
    bottom: 32px;
    left: 50%;
    transform: translateX(-50%) translateY(20px);
    background: var(--surface2);
    border: 1px solid var(--border2);
    color: var(--text);
    padding: 12px 24px;
    border-radius: 100px;
    font-size: 0.85rem;
    font-weight: 500;
    opacity: 0;
    transition: all 0.3s ease;
    pointer-events: none;
    z-index: 100;
    white-space: nowrap;
  }
  .toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }

  .section-title { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; }
  .section-title h3 { font-family: 'Playfair Display', serif; font-size: 1.1rem; font-weight: 400; color: var(--muted); font-style: italic; }
  .clear-all { font-size: 0.75rem; color: var(--dim); background: none; border: none; cursor: pointer; font-family: 'Nunito', sans-serif; transition: color 0.2s; }
  .clear-all:hover { color: var(--pink); }
  .saved-list { display: flex; flex-direction: column; gap: 10px; }
  .saved-item { background: var(--surface); border: 1px solid var(--border); border-radius: 16px; padding: 18px 20px; display: flex; gap: 14px; align-items: flex-start; animation: fadeUp 0.4s ease; transition: border-color 0.2s; }
  .saved-item:hover { border-color: var(--border2); }
  .saved-item p { flex: 1; font-family: 'Playfair Display', serif; font-size: 1rem; font-weight: 400; line-height: 1.55; color: #c8c0e0; }
  .theme-badge { font-size: 0.68rem; font-weight: 600; letter-spacing: 0.08em; text-transform: uppercase; color: var(--violet); opacity: 0.6; margin-top: 6px; font-family: 'Nunito', sans-serif; }
  .del-item { background: none; border: none; color: var(--dim); cursor: pointer; font-size: 0.9rem; padding: 2px; transition: color 0.2s; flex-shrink: 0; line-height: 1; margin-top: 2px; }
  .del-item:hover { color: var(--pink); }

  @keyframes fadeDown { from { opacity:0; transform:translateY(-24px); } to { opacity:1; transform:none; } }
  @keyframes fadeUp { from { opacity:0; transform:translateY(24px); } to { opacity:1; transform:none; } }

  @media (max-width: 520px) {
    .vision-card { padding: 24px 20px; }
    .affirmation-card { padding: 36px 24px; }
    .btn-ai { min-width: 140px; }
  }
</style>
</head>
<body>

<div class="stars" id="stars"></div>
<div class="orb orb-1"></div>
<div class="orb orb-2"></div>
<div class="orb orb-3"></div>

<div class="container">
  <header>
    <div class="app-badge">‚ú¶ Daily Affirmations App</div>
    <h1>Manifest Your Words</h1>
    <p class="tagline">The app that turns your dreams into daily affirmations ‚Äî<br>speak them, believe them, live them.</p>
    <button class="how-btn" onclick="openModal()">? How affirmations work</button>
    <a class="how-btn game-link" href="affirmations-game.html">üéÆ Play Affirmation Pairs</a>
  </header>

  <div class="modal-overlay" id="modalOverlay" onclick="closeModalOutside(event)">
    <div class="modal">
      <button class="modal-close" onclick="closeModal()">‚úï</button>
      <h2>How Affirmations Work</h2>
      <p class="modal-subtitle">A simple guide to getting the most from your practice</p>
      <div class="modal-section">
        <h3>üß† What is an affirmation?</h3>
        <p>An affirmation is a positive statement written in the present tense, as if what you want is already true. The idea is to train your mind to believe something before it has fully happened ‚Äî shifting your thoughts, feelings, and ultimately your actions toward the life you want.</p>
      </div>
      <div class="modal-section">
        <h3>‚ú® Why do they work?</h3>
        <p>Your brain has a system called the Reticular Activating System (RAS) that filters what you notice in the world. When you repeat affirmations regularly, you're essentially programming your RAS to spot opportunities, people, and situations that align with your goals ‚Äî things you might have overlooked before.</p>
      </div>
      <div class="modal-section">
        <h3>üåÖ When should I use them?</h3>
        <p>The best times are first thing in the morning before your mind fills with the day's noise, and last thing at night when your subconscious is most receptive. Even just 5 minutes of reading or repeating your affirmation can make a real difference over time.</p>
      </div>
      <div class="modal-section">
        <h3>üîÅ How do I use this app?</h3>
        <p>Describe what you genuinely want in your life in the box ‚Äî be as specific or as broad as you like. Press <em>Create New Affirmation</em> to get one tailored to your vision, or <em>Surprise me</em> for a random spark of inspiration. When one resonates, save it and come back to it daily.</p>
      </div>
      <div class="modal-section">
        <h3>üíõ Tips for best results</h3>
        <p>Say your affirmation out loud if you can. Feel it as you say it ‚Äî don't just read the words, try to genuinely connect with the emotion behind them. Consistency matters more than perfection. Even on days it feels silly, keep going. The shift happens gradually and then all at once.</p>
      </div>
      <div class="modal-tip">
        <strong>Remember:</strong> Affirmations work best alongside action. They open your mind to possibility ‚Äî but taking small steps toward your vision every day is what makes the magic real.
      </div>
    </div>
  </div>

  <div class="vision-card">
    <label>What do you want in your life?</label>
    <textarea class="vision-textarea" id="visionInput" placeholder="e.g. I want to feel more confident in my career, find inner peace, attract loving relationships, and build healthy habits that stick..."></textarea>
    <div class="mood-row">
      <span class="quick-label">Quick add:</span>
      <button class="mood-chip" data-text="more confidence and self-belief">Confidence</button>
      <button class="mood-chip" data-text="inner peace and a calm mind">Peace</button>
      <button class="mood-chip" data-text="financial abundance and security">Abundance</button>
      <button class="mood-chip" data-text="deeper, loving relationships">Love</button>
      <button class="mood-chip" data-text="better health and energy">Health</button>
      <button class="mood-chip" data-text="clarity of purpose and direction">Purpose</button>
      <button class="mood-chip" data-text="joy and gratitude every day">Joy</button>
    </div>
    <div class="btn-row">
      <button class="btn-ai" id="generateBtn" onclick="generateAI()">
        <span id="btnLabel">‚ú¶ Create New Affirmation</span>
      </button>
      <button class="btn-random" id="randomBtn" onclick="quickRandom()">‚ú® Surprise me</button>
    </div>
  </div>

  <div class="result-area">
    <div class="affirmation-card">
      <div class="card-glow"></div>
      <p class="affirmation-text placeholder-text" id="affText">Your affirmation will appear here...</p>
      <p class="affirmation-theme" id="affTheme"></p>
    </div>
    <div class="card-actions">
      <button class="act-btn save-btn" onclick="saveCurrentAff()">‚ô° Save</button>
      <button class="act-btn copy-btn" id="copyBtn" onclick="copyAff()">‚éò Copy Affirmation</button>
      <button class="act-btn share-btn" onclick="shareAff()">‚Üó Share</button>
      <button class="act-btn speak-btn" id="speakBtn" onclick="toggleSpeak()">üîä Listen</button>
    </div>
  </div>

  <div class="saved-section" id="savedSection" style="display:none">
    <div class="divider"></div>
    <div class="section-title">
      <h3>Your Collection</h3>
      <button class="clear-all" onclick="clearAll()">Clear all</button>
    </div>
    <div class="saved-list" id="savedList"></div>
  </div>
</div>

<div class="toast" id="toast"></div>

<script>
(function() {
  const container = document.getElementById('stars');
  for (let i = 0; i < 80; i++) {
    const s = document.createElement('div');
    s.className = 'star';
    const size = Math.random() * 2 + 0.5;
    s.style.cssText = `width:${size}px;height:${size}px;top:${Math.random()*100}%;left:${Math.random()*100}%;--d:${2+Math.random()*4}s;--delay:${Math.random()*5}s;--op:${0.3+Math.random()*0.7};`;
    container.appendChild(s);
  }
})();

let saved = JSON.parse(localStorage.getItem('bloom_saved_v2') || '[]');

document.querySelectorAll('.mood-chip').forEach(chip => {
  chip.addEventListener('click', () => {
    const input = document.getElementById('visionInput');
    const add = chip.dataset.text;
    chip.classList.toggle('active');
    if (chip.classList.contains('active')) {
      input.value = input.value ? input.value.trimEnd() + ', ' + add : add;
    } else {
      input.value = input.value.replace(', ' + add, '').replace(add + ', ', '').replace(add, '').trim();
    }
  });
});

// ‚îÄ‚îÄ‚îÄ Affirmation Engine ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

function pick(arr) { return arr[Math.floor(Math.random() * arr.length)]; }

function keywords(vision) {
  const stop = new Set([
    'i','want','to','a','an','the','and','or','in','my','me','more','feel','have',
    'be','of','with','for','that','is','are','it','so','very','really','just','get',
    'like','love','find','life','live','help','make','also','some','good','better',
    'able','would','could','things','thing','every','each','less','much','many',
    'well','even','know','think','need','wish','hope','seem','keep','start','stop',
    'try','let','put','see','look','come','this','that','these','those','them',
    'they','their','there','then','than','when','what','which','who','how','why',
    'where','will','can','may','might','must','shall'
  ]);
  return vision.toLowerCase().replace(/[^a-z\s]/g,'').split(/\s+/).filter(w =>
    w.length > 3 && !stop.has(w) && !w.endsWith('ly') && !w.endsWith('ing') && !w.endsWith('ed')
  );
}

const themes = [
  "Inner Peace","Self-Trust","Abundance","Courage","Healing","Joy",
  "Confidence","Growth","Freedom","Love","Purpose","Resilience",
  "Alignment","Creativity","Wellness","Gratitude","Manifestation","Connection"
];

const visionTemplates = [
  kw => `I am becoming someone who naturally lives with more ${kw}, and every day I feel this growing within me.`,
  kw => `I have everything I need to build a life full of ${kw}, and I trust myself to create it.`,
  kw => `I choose ${kw} ‚Äî it is my natural state, and I return to it with ease.`,
  kw => `I am worthy of all the ${kw} I desire, and I open myself fully to receiving it now.`,
  kw => `I radiate ${kw} from the inside out, and it shapes everything I attract into my life.`,
  kw => `I embrace ${kw} as my birthright ‚Äî it belongs to me and I step into it fully today.`,
  kw => `With every breath, I welcome more ${kw} into my life, gently and without resistance.`,
  kw => `I trust that ${kw} is already flowing toward me, even in ways I cannot yet see.`,
  kw => `I am deeply aligned with ${kw}, and life continues to show me how real this is.`,
  kw => `I allow ${kw} to fill every corner of my life ‚Äî I am ready and I am open.`,
  kw => `I am releasing everything that blocks my ${kw}, making space for all that is meant for me.`,
  kw => `My connection to ${kw} grows stronger every single day, quietly and powerfully.`,
  kw => `I deserve a life rich with ${kw}, and I take one small step toward it every day.`,
  kw => `I am not waiting for ${kw} ‚Äî I am living it now, in every choice I make.`,
  kw => `I carry a deep and growing sense of ${kw} within me that no circumstance can take away.`,
];

const randomTemplates = [
  () => `I am exactly where I need to be, and I trust the journey that is unfolding before me.`,
  () => `I choose peace ‚Äî not because life is perfect, but because I am.`,
  () => `I am a magnet for goodness, and wonderful things find their way to me with ease.`,
  () => `I am free ‚Äî free from fear, free to grow, and free to be fully, unapologetically myself.`,
  () => `I give myself permission to take up space, to be seen, and to shine without apology.`,
  () => `I am not behind. I am not too late. I am right on time for my own beautiful life.`,
  () => `I trust myself completely ‚Äî my instincts guide me and my choices serve me well.`,
  () => `I am healing in ways both seen and unseen, and I honour every step of this journey.`,
  () => `I radiate warmth and confidence, and the world around me reflects that back beautifully.`,
  () => `I deserve deep rest, real love, and a life that feels genuinely mine.`,
  () => `I am grateful for who I am today and excited about who I am still becoming.`,
  () => `Joy is not something I have to earn ‚Äî it is my birthright, and I claim it right now.`,
  () => `I attract relationships that nourish me, challenge me, and lift me higher.`,
  () => `I am resilient. Every challenge I face is quietly making me wiser and stronger.`,
  () => `I move through life with grace and ease, and good things come to me naturally.`,
  () => `My mind is calm, my heart is open, and I am ready for everything that is coming.`,
  () => `I choose to see the beauty in this moment ‚Äî it is always there if I look for it.`,
  () => `I am creative, capable, and full of ideas that have the power to change my world.`,
  () => `Abundance flows to me in expected and unexpected ways, and I receive it with gratitude.`,
  () => `I am learning to love myself more fully every single day, and it changes everything.`,
];

function buildVisionAffirmation(vision) {
  const kws = keywords(vision);
  const kw = kws[0] || pick(['confidence','peace','joy','love','abundance','health','growth','clarity']);
  return { affirmation: pick(visionTemplates)(kw), theme: pick(themes) };
}

function buildRandomAffirmation() {
  return { affirmation: pick(randomTemplates)(), theme: pick(themes) };
}

function generateAI() {
  const vision = document.getElementById('visionInput').value.trim();
  if (!vision) { document.getElementById('visionInput').focus(); showToast('Tell me what you want in your life ‚ú¶'); return; }
  showResult(buildVisionAffirmation(vision));
}

function quickRandom() { showResult(buildRandomAffirmation()); }

function showResult(item) {
  stopSpeaking();
  const text = document.getElementById('affText');
  const theme = document.getElementById('affTheme');
  text.classList.add('fade');
  setTimeout(() => {
    text.textContent = item.affirmation;
    text.classList.remove('placeholder-text');
    theme.textContent = item.theme;
    text.classList.remove('fade');
  }, 320);
}

function saveCurrentAff() {
  const text = document.getElementById('affText').textContent;
  const theme = document.getElementById('affTheme').textContent;
  if (!text || text.includes('appear here') || saved.find(s => s.affirmation === text)) { showToast('Already saved ‚úì'); return; }
  saved.unshift({ affirmation: text, theme });
  localStorage.setItem('bloom_saved_v2', JSON.stringify(saved));
  renderSaved();
  showToast('Saved to your collection ‚ô°');
}

function shareAff() {
  const text = document.getElementById('affText').textContent;
  const theme = document.getElementById('affTheme').textContent;
  if (!text || text.includes('appear here')) { showToast('Generate an affirmation first ‚ú¶'); return; }
  const shareText = `‚ú® ${text}\n\n‚Äî ${theme} affirmation from Bloom üå∏`;
  if (navigator.share) {
    navigator.share({ text: shareText }).then(() => showToast('Shared! üå∏')).catch(() => {});
  } else {
    navigator.clipboard.writeText(shareText).then(() => showToast('Copied ‚Äî ready to paste & share! ‚éò'));
  }
}

function copyAff() {
  const text = document.getElementById('affText').textContent;
  if (!text || text.includes('appear here')) return;
  navigator.clipboard.writeText(text).then(() => {
    const btn = document.getElementById('copyBtn');
    btn.textContent = '‚úì Copied!';
    btn.style.background = 'rgba(251,191,36,0.25)';
    showToast('Copied to clipboard ‚éò');
    setTimeout(() => { btn.textContent = '‚éò Copy Affirmation'; btn.style.background = ''; }, 2000);
  });
}

function deleteSaved(i) {
  saved.splice(i, 1);
  localStorage.setItem('bloom_saved_v2', JSON.stringify(saved));
  renderSaved();
}

function clearAll() {
  saved = [];
  localStorage.setItem('bloom_saved_v2', JSON.stringify(saved));
  renderSaved();
}

function renderSaved() {
  const section = document.getElementById('savedSection');
  const list = document.getElementById('savedList');
  if (!saved.length) { section.style.display = 'none'; return; }
  section.style.display = 'block';
  list.innerHTML = saved.map((s, i) => `
    <div class="saved-item">
      <div style="flex:1">
        <p>${s.affirmation}</p>
        <div class="theme-badge">${s.theme}</div>
      </div>
      <button class="del-item" onclick="deleteSaved(${i})">‚úï</button>
    </div>
  `).join('');
}

// ‚îÄ‚îÄ‚îÄ Text-to-Speech ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let isSpeaking = false;
let bestVoice = null;

function loadBestVoice() {
  const voices = window.speechSynthesis.getVoices();
  const preferred = ['Samantha','Karen','Moira','Tessa','Ava','Allison','Fiona','Victoria','Daniel','Martha'];
  for (const name of preferred) {
    const match = voices.find(v => v.name.includes(name) && v.lang.startsWith('en'));
    if (match) { bestVoice = match; return; }
  }
  bestVoice = voices.find(v => v.lang.startsWith('en')) || null;
}
window.speechSynthesis.onvoiceschanged = loadBestVoice;
loadBestVoice();

function toggleSpeak() {
  const text = document.getElementById('affText').textContent;
  const btn = document.getElementById('speakBtn');
  if (!text || text.includes('appear here')) { showToast('Generate an affirmation first ‚ú¶'); return; }
  if (isSpeaking) {
    window.speechSynthesis.cancel();
    isSpeaking = false;
    btn.textContent = 'üîä Listen';
    btn.classList.remove('speaking');
    return;
  }
  const sentences = text.match(/[^.!?]+[.!?]*/g) || [text];
  let idx = 0;
  function speakNext() {
    if (idx >= sentences.length) { isSpeaking = false; btn.textContent = 'üîä Listen'; btn.classList.remove('speaking'); return; }
    const s = sentences[idx].trim();
    if (!s) { idx++; speakNext(); return; }
    const u = new SpeechSynthesisUtterance(s);
    u.rate = 0.78; u.pitch = 1.12; u.volume = 0.95;
    if (bestVoice) u.voice = bestVoice;
    u.onend = () => { idx++; setTimeout(speakNext, 650); };
    u.onerror = () => { isSpeaking = false; btn.textContent = 'üîä Listen'; btn.classList.remove('speaking'); };
    window.speechSynthesis.speak(u);
  }
  isSpeaking = true;
  btn.textContent = '‚èπ Stop';
  btn.classList.add('speaking');
  speakNext();
}

function stopSpeaking() {
  window.speechSynthesis.cancel();
  isSpeaking = false;
  const btn = document.getElementById('speakBtn');
  if (btn) { btn.textContent = 'üîä Listen'; btn.classList.remove('speaking'); }
}

function openModal() { document.getElementById('modalOverlay').classList.add('open'); document.body.style.overflow = 'hidden'; }
function closeModal() { document.getElementById('modalOverlay').classList.remove('open'); document.body.style.overflow = ''; }
function closeModalOutside(e) { if (e.target === document.getElementById('modalOverlay')) closeModal(); }

function showToast(msg) {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.classList.add('show');
  setTimeout(() => t.classList.remove('show'), 2500);
}

document.getElementById('visionInput').addEventListener('keydown', e => {
  if (e.key === 'Enter' && (e.ctrlKey || e.metaKey)) generateAI();
});

renderSaved();
</script>
</body>
</html>
